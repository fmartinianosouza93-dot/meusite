<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Cobrança SGC</title>
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f5f5f5;color:#333;}
header{background:#001f4d;color:#fff;padding:1rem;text-align:center;}
nav{display:flex;justify-content:center;background:#003366;}
nav button{margin:0.5rem;padding:0.5rem 1rem;border:none;border-radius:5px;background:#fff;cursor:pointer;}
nav button.active{background:#ffcc00;}
nav button:disabled{background:#ccc;cursor:not-allowed;}
section{padding:1rem;display:none;}
section.active{display:block;}
input,select,textarea{padding:0.5rem;margin:0.5rem 0;width:100%;}
table{width:100%;border-collapse:collapse;margin-top:1rem;}
th,td{border:1px solid #ccc;padding:0.5rem;text-align:left;}
th{background:#eee;}
.chat-box{height:200px;overflow-y:scroll;border:1px solid #ccc;padding:0.5rem;background:#fff;}
.status-msg{margin-top:0.5rem;padding:0.5rem;border-radius:5px;display:none;}
.success{background:#d4edda;color:#155724;}
.error{background:#f8d7da;color:#721c24;}
</style>
</head>
<body>

<header>
<h1>Sistema de Cobrança SGC</h1>
<div id="user-info"></div>
</header>

<nav>
<button onclick="showSection('login')" class="active">Login</button>
<button onclick="showSection('boletos')">Boletos</button>
<button onclick="showSection('inadimplentes')">Inadimplentes</button>
<button onclick="showSection('securitizadoras')">Securitizadoras</button>
<button onclick="showSection('alt')">ALT</button>
<button onclick="showSection('chat')">Chat</button>
</nav>

<!-- Login simples -->
<section id="login" class="active">
<h2>Identifique-se</h2>
<input type="text" id="userName" placeholder="Digite seu nome">
<button onclick="simpleLogin()">Entrar</button>
<div id="loginStatus" class="status-msg"></div>
</section>

<!-- Boletos -->
<section id="boletos">
<h2>Boletos</h2>
<input type="text" id="boletoCliente" placeholder="Cliente">
<input type="number" id="boletoValor" placeholder="Valor">
<input type="date" id="boletoVencimento">
<select id="boletoStatusSelect">
<option value="normal">Normal</option>
<option value="repassado">Repassado</option>
<option value="recomprado">Recomprado</option>
</select>
<button onclick="addBoleto()">Adicionar Boleto</button>
<table id="boletosTable">
<thead><tr><th>Cliente</th><th>Valor</th><th>Vencimento</th><th>Status</th><th>Ações</th></tr></thead>
<tbody></tbody>
</table>
<div id="boletoStatus" class="status-msg"></div>
</section>

<!-- Inadimplentes -->
<section id="inadimplentes">
<h2>Inadimplentes</h2>
<table id="inadimplentesTable">
<thead><tr><th>Cliente</th><th>Valor</th><th>Vencimento</th><th>Dias em atraso</th><th>Status</th></tr></thead>
<tbody></tbody>
</table>
</section>

<!-- Securitizadoras -->
<section id="securitizadoras">
<h2>Securitizadoras</h2>
<input type="text" id="securitizadoraNome" placeholder="Nome da Securitizadora">
<button onclick="addSecuritizadora()">Adicionar</button>
<table id="securitizadorasTable">
<thead><tr><th>Nome</th><th>Ações</th></tr></thead>
<tbody></tbody>
</table>
<div id="securitizadoraStatus" class="status-msg"></div>
</section>

<!-- ALT -->
<section id="alt">
<h2>ALT</h2>
<p>Espaço para relatórios ou funcionalidades futuras.</p>
</section>

<!-- Chat -->
<section id="chat">
<h2>Chat</h2>
<div class="chat-box" id="chatBox"></div>
<input type="text" id="chatMsg" placeholder="Digite uma mensagem">
<button onclick="sendMsg()">Enviar</button>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

const firebaseConfig = {
  apiKey:"AIzaSyDgpKA5IyE7IGYvxoSIHEqvhgY_OqU4w7k",
  authDomain:"sistema-de-cobranca-a1ede.firebaseapp.com",
  databaseURL:"https://sistema-de-cobranca-a1ede-default-rtdb.firebaseio.com",
  projectId:"sistema-de-cobranca-a1ede",
  storageBucket:"sistema-de-cobranca-a1ede.appspot.com",
  messagingSenderId:"817281254537",
  appId:"1:817281254537:web:398b007b96af406c91f258",
  measurementId:"G-MQ9HH83L6B"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Navegação
const navButtons = document.querySelectorAll('nav button:not(:first-child)');
navButtons.forEach(btn=>btn.disabled=true);

let currentUser = '';

function showSection(id){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.querySelector(`nav button[onclick="showSection('${id}')"]`).classList.add('active');
}

// Status visual
function showStatus(id,msg,type='success'){
  const statusDiv=document.getElementById(id);
  statusDiv.style.display='block';
  statusDiv.className=`status-msg ${type}`;
  statusDiv.textContent=msg;
  setTimeout(()=>statusDiv.style.display='none',4000);
}

// Login simples
function simpleLogin(){
  const name = document.getElementById('userName').value.trim();
  if(!name){
    showStatus('loginStatus','Digite seu nome','error');
    return;
  }
  currentUser = name;
  showStatus('loginStatus',`Bem-vindo, ${name}`,'success');
  document.getElementById('user-info').innerText = `Logado como: ${name}`;
  
  // Habilita menu e abre Chat
  navButtons.forEach(btn => btn.disabled=false);
  showSection('chat');
}

// Boletos CRUD
function addBoleto(){
  const cliente=document.getElementById('boletoCliente').value;
  const valor=document.getElementById('boletoValor').value;
  const vencimento=document.getElementById('boletoVencimento').value;
  const status=document.getElementById('boletoStatusSelect').value;
  if(!cliente||!valor||!vencimento){showStatus('boletoStatus','Preencha todos os campos','error');return;}
  const key=push(ref(db,'boletos')).key;
  set(ref(db,'boletos/'+key),{cliente,valor,vencimento,status});
  document.getElementById('boletoCliente').value='';
  document.getElementById('boletoValor').value='';
  document.getElementById('boletoVencimento').value='';
  showStatus('boletoStatus','Boleto adicionado','success');
}

onValue(ref(db,'boletos'), snapshot=>{
  const tbody=document.querySelector('#boletosTable tbody');
  const tbodyInad=document.querySelector('#inadimplentesTable tbody');
  tbody.innerHTML='';
  tbodyInad.innerHTML='';
  const today=new Date();
  snapshot.forEach(s=>{
    const data=s.val();
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${data.cliente}</td><td>${data.valor}</td><td>${data.vencimento}</td><td>${data.status}</td><td><button onclick="deleteBoleto('${s.key}')">Excluir</button></td>`;
    tbody.appendChild(tr);

    const venc=new Date(data.vencimento);
    if(venc<today){
      const trInad=document.createElement('tr');
      const dias=Math.floor((today-venc)/(1000*60*60*24));
      trInad.innerHTML=`<td>${data.cliente}</td><td>${data.valor}</td><td>${data.vencimento}</td><td>${dias}</td><td>${data.status}</td>`;
      tbodyInad.appendChild(trInad);
    }
  });
});

function deleteBoleto(key){ remove(ref(db,'boletos/'+key)); }

// Securitizadoras CRUD
function addSecuritizadora(){
  const nome=document.getElementById('securitizadoraNome').value;
  if(!nome){showStatus('securitizadoraStatus','Digite o nome','error');return;}
  const key=push(ref(db,'securitizadoras')).key;
  set(ref(db,'securitizadoras/'+key),{nome});
  document.getElementById('securitizadoraNome').value='';
  showStatus('securitizadoraStatus','Securitizadora adicionada','success');
}

onValue(ref(db,'securitizadoras'),snapshot=>{
  const tbody=document.querySelector('#securitizadorasTable tbody');
  tbody.innerHTML='';
  snapshot.forEach(s=>{
    const data=s.val();
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${data.nome}</td><td><button onclick="deleteSecuritizadora('${s.key}')">Excluir</button></td>`;
    tbody.appendChild(tr);
  });
});

function deleteSecuritizadora(key){ remove(ref(db,'securitizadoras/'+key)); }

// Chat
function sendMsg(){
  const msg=document.getElementById('chatMsg').value;
  if(!msg || !currentUser) return;
  const key=push(ref(db,'chat')).key;
  set(ref(db,'chat/'+key),{user:currentUser,msg,time:Date.now()});
  document.getElementById('chatMsg').value='';
}

onValue(ref(db,'chat'),snapshot=>{
  const box=document.getElementById('chatBox');
  box.innerHTML='';
  snapshot.forEach(s=>{
    const data=s.val();
    const date=new Date(data.time);
    const div=document.createElement('div');
    div.textContent=`[${date.toLocaleTimeString()}] ${data.user}: ${data.msg}`;
    box.appendChild(div);
  });
  document.getElementById('chatBox').scrollTop=box.scrollHeight;
});
</script>
</body>
</html>
