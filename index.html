<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Cobrança Online</title>
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f5f5f5;color:#333;}
header{background:#001f4d;color:#fff;padding:1rem;text-align:center;}
nav{display:flex;justify-content:center;background:#003366;}
nav button{margin:0.5rem;padding:0.5rem 1rem;border:none;border-radius:5px;background:#fff;cursor:pointer;}
nav button.active{background:#ffcc00;}
nav button:disabled{background:#ccc;cursor:not-allowed;}
section{padding:1rem;display:none;}
section.active{display:block;}
input,select,textarea{padding:0.5rem;margin:0.5rem 0;width:100%;}
table{width:100%;border-collapse:collapse;margin-top:1rem;}
th,td{border:1px solid #ccc;padding:0.5rem;text-align:left;}
th{background:#eee;}
button.action-btn{margin:0 2px;padding:0.2rem 0.5rem;cursor:pointer;border:none;border-radius:3px;}
button.pago{background:#28a745;color:#fff;}
button.naoPago{background:#dc3545;color:#fff;}
button.action-btn:hover{opacity:0.8;}
.chat-box{height:200px;overflow-y:scroll;border:1px solid #ccc;padding:0.5rem;background:#fff;}
.status-msg{margin-top:0.5rem;padding:0.5rem;border-radius:5px;display:none;}
.success{background:#d4edda;color:#155724;}
.error{background:#f8d7da;color:#721c24;}
textarea{resize:none;width:100%;height:60px;}
.filter-group{margin-bottom:0.5rem;}
</style>
</head>
<body>

<header>
<h1>Sistema de Cobrança Online</h1>
<div id="user-info"></div>
</header>

<nav>
<button onclick="showSection('login')" class="active">Login</button>
<button onclick="showSection('inadimplentes')">Inadimplentes</button>
<button onclick="showSection('chat')">Chat</button>
</nav>

<!-- LOGIN -->
<section id="login" class="active">
<h2>Identifique-se</h2>
<input type="text" id="userName" placeholder="Digite seu nome">
<button onclick="simpleLogin()">Entrar</button>
<div id="loginStatus" class="status-msg"></div>
</section>

<!-- INADIMPLENTES -->
<section id="inadimplentes">
<h2>Inadimplentes</h2>

<div class="filter-group">
<label>Filtrar por operador:</label>
<select id="filterOperador" onchange="renderInadimplentes()">
<option value="">Todos</option>
</select>

<label>Filtrar por status:</label>
<select id="filterPago" onchange="renderInadimplentes()">
<option value="">Todos</option>
<option value="true">Pago</option>
<option value="false">Não Pago</option>
</select>
</div>

<input type="text" id="inadCliente" placeholder="Cliente">
<input type="date" id="inadVencimento">
<input type="text" id="inadNota" placeholder="Nota">
<input type="number" id="inadValor" placeholder="Valor">
<button onclick="addInadimplente()">Adicionar</button>

<table id="inadimplentesTable">
<thead>
<tr>
<th>Cliente</th>
<th>Vencimento</th>
<th>Nota</th>
<th>Valor</th>
<th>Operador</th>
<th>Securitizadora/SGC</th>
<th>Observações</th>
<th>Pago/Não Pago</th>
<th>Ações</th>
</tr>
</thead>
<tbody></tbody>
</table>
<div id="inadStatus" class="status-msg"></div>
</section>

<!-- CHAT -->
<section id="chat">
<h2>Chat</h2>
<div class="chat-box" id="chatBox"></div>
<input type="text" id="chatMsg" placeholder="Digite uma mensagem">
<button onclick="sendMsg()">Enviar</button>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

// Configuração Firebase
const firebaseConfig = {
  apiKey:"AIzaSyDgpKA5IyE7IGYvxoSIHEqvhgY_OqU4w7k",
  authDomain:"sistema-de-cobranca-a1ede.firebaseapp.com",
  databaseURL:"https://sistema-de-cobranca-a1ede-default-rtdb.firebaseio.com",
  projectId:"sistema-de-cobranca-a1ede",
  storageBucket:"sistema-de-cobranca-a1ede.appspot.com",
  messagingSenderId:"817281254537",
  appId:"1:817281254537:web:398b007b96af406c91f258"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Navegação
const navButtons = document.querySelectorAll('nav button:not(:first-child)');
navButtons.forEach(btn=>btn.disabled=true);
let currentUser='';
let inadData = {};

// Navegação
function showSection(id){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.querySelector(`nav button[onclick="showSection('${id}')"]`).classList.add('active');
}

function showStatus(id,msg,type='success'){
  const statusDiv=document.getElementById(id);
  statusDiv.style.display='block';
  statusDiv.className=`status-msg ${type}`;
  statusDiv.textContent=msg;
  setTimeout(()=>statusDiv.style.display='none',4000);
}

// Login simples
function simpleLogin(){
  const name = document.getElementById('userName').value.trim();
  if(!name){ showStatus('loginStatus','Digite seu nome','error'); return; }
  currentUser = name;
  showStatus('loginStatus',`Bem-vindo, ${name}`,'success');
  document.getElementById('user-info').innerText = `Logado como: ${name}`;
  navButtons.forEach(btn=>btn.disabled=false);
  showSection('inadimplentes');
}

// Inadimplentes online
const inadRef = ref(db,'inadimplentes');

function addInadimplente(){
  const cliente = document.getElementById('inadCliente').value.trim();
  const vencimento = document.getElementById('inadVencimento').value;
  const nota = document.getElementById('inadNota').value.trim();
  const valor = document.getElementById('inadValor').value;
  if(!cliente || !vencimento || !nota || !valor){showStatus('inadStatus','Preencha todos os campos','error'); return;}
  const key = push(inadRef).key;
  update(ref(db,'inadimplentes/'+key),{
    cliente,vencimento,nota,valor,operador:currentUser,observacoes:'',pago:false
  });
  document.getElementById('inadCliente').value='';
  document.getElementById('inadVencimento').value='';
  document.getElementById('inadNota').value='';
  document.getElementById('inadValor').value='';
  showStatus('inadStatus','Inadimplente adicionado','success');
}

onValue(inadRef,snapshot=>{
  inadData = {};
  snapshot.forEach(s=>{
    inadData[s.key] = s.val();
  });
  renderInadimplentes();
});

// Renderizar tabela com filtros
function renderInadimplentes(){
  const tbody = document.querySelector('#inadimplentesTable tbody');
  tbody.innerHTML='';
  const operadorFilter = document.getElementById('filterOperador').value;
  const pagoFilter = document.getElementById('filterPago').value;

  const operadoresSet = new Set();
  Object.keys(inadData).forEach(key=>{
    const data = inadData[key];
    operadoresSet.add(data.operador);
  });
  const filtroOperadorSelect = document.getElementById('filterOperador');
  filtroOperadorSelect.innerHTML = '<option value="">Todos</option>';
  operadoresSet.forEach(op=>{
    filtroOperadorSelect.innerHTML += `<option value="${op}">${op}</option>`;
  });

  Object.keys(inadData).forEach(key=>{
    const data = inadData[key];
    if(operadorFilter && data.operador !== operadorFilter) return;
    if(pagoFilter && String(data.pago)!==pagoFilter) return;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${data.cliente}</td>
      <td>${data.vencimento}</td>
      <td>${data.nota}</td>
      <td>${data.valor}</td>
      <td>${data.operador}</td>
      <td>
        <button class="action-btn" onclick="markSecuritizadora('${key}')">Securitizadora</button>
        <button class="action-btn" onclick="markSGC('${key}')">SGC</button>
      </td>
      <td><textarea onchange="updateObservacoes('${key}',this.value)">${data.observacoes}</textarea></td>
      <td>
        <button class="action-btn ${data.pago?'pago':'naoPago'}" onclick="togglePago('${key}',this)">${data.pago?'Pago':'Não Pago'}</button>
      </td>
      <td><button class="action-btn" onclick="deleteInad('${key}')">Excluir</button></td>
    `;
    tbody.appendChild(tr);
  });
}

// Ações Inadimplentes
function markSecuritizadora(key){update(ref(db,'inadimplentes/'+key),{acao:'Securitizadora'});}
function markSGC(key){update(ref(db,'inadimplentes/'+key),{acao:'SGC'});}
function updateObservacoes(key,val){update(ref(db,'inadimplentes/'+key),{observacoes:val});}
function togglePago(key,btn){
  const itemRef = ref(db,'inadimplentes/'+key);
  update(itemRef,{pago:!inadData[key].pago});
}
function deleteInad(key){remove(ref(db,'inadimplentes/'+key));}

// Chat online
const chatRef = ref(db,'chat');
function sendMsg(){
  const msg=document.getElementById('chatMsg').value.trim();
  if(!msg || !currentUser) return;
  push(chatRef,{user:currentUser,msg,time:Date.now()});
  document.getElementById('chatMsg').value='';
}
onValue(chatRef,snapshot=>{
  const box=document.getElementById('chatBox');
  box.innerHTML='';
  snapshot.forEach(s=>{
    const data=s.val();
    const date = new Date(data.time);
    const div = document.createElement('div');
    div.textContent = `[${date.toLocaleTimeString()}] ${data.user}: ${data.msg}`;
    box.appendChild(div);
  });
  document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
});
</script>

</body>
</html>
