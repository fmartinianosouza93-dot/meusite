<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Cobrança SGC</title>
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f5f5f5;color:#333;}
header{background:#001f4d;color:#fff;padding:1rem;text-align:center;}
nav{display:flex;justify-content:center;background:#003366;}
nav button{margin:0.5rem;padding:0.5rem 1rem;border:none;border-radius:5px;background:#fff;cursor:pointer;}
nav button.active{background:#ffcc00;}
nav button:disabled{background:#ccc;cursor:not-allowed;}
section{padding:1rem;display:none;}
section.active{display:block;}
input,select,textarea{padding:0.5rem;margin:0.5rem 0;width:100%;}
table{width:100%;border-collapse:collapse;margin-top:1rem;}
th,td{border:1px solid #ccc;padding:0.5rem;text-align:left;}
th{background:#eee;}
.chat-box{height:200px;overflow-y:scroll;border:1px solid #ccc;padding:0.5rem;background:#fff;}
.status-msg{margin-top:0.5rem;padding:0.5rem;border-radius:5px;display:none;}
.success{background:#d4edda;color:#155724;}
.error{background:#f8d7da;color:#721c24;}
</style>
</head>
<body>

<header>
<h1>Sistema de Cobrança SGC</h1>
<div id="user-info"></div>
</header>

<nav>
<button onclick="showSection('login')" class="active">Login</button>
<button onclick="showSection('boletos')">Boletos</button>
<button onclick="showSection('inadimplentes')">Inadimplentes</button>
<button onclick="showSection('securitizadoras')">Securitizadoras</button>
<button onclick="showSection('alt')">ALT</button>
<button onclick="showSection('chat')">Chat</button>
</nav>

<section id="login" class="active">
<h2>Login / Cadastro</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="senha" placeholder="Senha">
<button onclick="login()">Login</button>
<button onclick="signup()">Cadastrar</button>
<button onclick="logout()">Sair</button>
<div id="loginStatus" class="status-msg"></div>
</section>

<section id="boletos">
<h2>Boletos</h2>
<input type="text" id="boletoCliente" placeholder="Cliente">
<input type="number" id="boletoValor" placeholder="Valor">
<input type="date" id="boletoVencimento">
<select id="boletoStatusSelect">
<option value="normal">Normal</option>
<option value="repassado">Repassado</option>
<option value="recomprado">Recomprado</option>
</select>
<button onclick="addBoleto()">Adicionar Boleto</button>
<table id="boletosTable">
<thead><tr><th>Cliente</th><th>Valor</th><th>Vencimento</th><th>Status</th><th>Ações</th></tr></thead>
<tbody></tbody>
</table>
<div id="boletoStatus" class="status-msg"></div>
</section>

<section id="inadimplentes">
<h2>Inadimplentes</h2>
<table id="inadimplentesTable">
<thead><tr><th>Cliente</th><th>Valor</th><th>Vencimento</th><th>Dias em atraso</th><th>Status</th></tr></thead>
<tbody></tbody>
</table>
</section>

<section id="securitizadoras">
<h2>Securitizadoras</h2>
<input type="text" id="securitizadoraNome" placeholder="Nome da Securitizadora">
<button onclick="addSecuritizadora()">Adicionar</button>
<table id="securitizadorasTable">
<thead><tr><th>Nome</th><th>Ações</th></tr></thead>
<tbody></tbody>
</table>
<div id="securitizadoraStatus" class="status-msg"></div>
</section>

<section id="alt">
<h2>ALT</h2>
<p>Espaço para relatórios ou funcionalidades futuras.</p>
</section>

<section id="chat">
<h2>Chat</h2>
<div class="chat-box" id="chatBox"></div>
<input type="text" id="chatMsg" placeholder="Digite uma mensagem">
<button onclick="sendMsg()">Enviar</button>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";

const firebaseConfig = {
apiKey:"AIzaSyDgpKA5IyE7IGYvxoSIHEqvhgY_OqU4w7k",
authDomain:"sistema-de-cobranca-a1ede.firebaseapp.com",
databaseURL:"https://sistema-de-cobranca-a1ede-default-rtdb.firebaseio.com",
projectId:"sistema-de-cobranca-a1ede",
storageBucket:"sistema-de-cobranca-a1ede.appspot.com",
messagingSenderId:"817281254537",
appId:"1:817281254537:web:398b007b96af406c91f258",
measurementId:"G-MQ9HH83L6B"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getDatabase(app);

// Navegação
const navButtons = document.querySelectorAll('nav button:not(:first-child)');
navButtons.forEach(btn=>btn.disabled=true);

function showSection(id){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.querySelector(`nav button[onclick="showSection('${id}')"]`).classList.add('active');
}

// Status visual
function showStatus(id,msg,type='success'){
  const statusDiv=document.getElementById(id);
  statusDiv.style.display='block';
  statusDiv.className=`status-msg ${type}`;
  statusDiv.textContent=msg;
  setTimeout(()=>statusDiv.style.display='none',4000);
}

// Autenticação
onAuthStateChanged(auth,user=>{
  if(user){
    navButtons.forEach(btn=>btn.disabled=false);
    document.getElementById('user-info').innerText=`Logado como: ${user.email}`;
    setTimeout(()=>showSection('boletos'),100);

    // Carregar boletos apenas quando logado
    const boletosRef = ref(db, 'boletos');
    onValue(boletosRef, snapshot => {
      const tbody=document.querySelector('#boletosTable tbody');
      const tbodyInad=document.querySelector('#inadimplentesTable tbody');
      tbody.innerHTML='';
      tbodyInad.innerHTML='';
      const today=new Date();
      snapshot.forEach(s=>{
        const data=s.val();
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${data.cliente}</td><td>${data.valor}</td><td>${data.vencimento}</td><td>${data.status}</td><td><button onclick="deleteBoleto('${s.key}')">Excluir</button></td>`;
        tbody.appendChild(tr);

        // Inadimplentes
        const venc=new Date(data.vencimento);
        if(venc<today){
          const trInad=document.createElement('tr');
          const dias=Math.floor((today-venc)/(1000*60*60*24));
          trInad.innerHTML=`<td>${data.cliente}</td><td>${data.valor}</td><td>${data.vencimento}</td><td>${dias}</td><td>${data.status}</td>`;
          tbodyInad.appendChild(trInad);
        }
      });
    });

  }else{
    navButtons.forEach(btn=>btn.disabled=true);
    document.getElementById('user-info').innerText='';
    showSection('login');
  }
});

// Login / Cadastro / Logout
window.login=()=>{
  const email=document.getElementById('email').value;
  const senha=document.getElementById('senha').value;
  signInWithEmailAndPassword(auth,email,senha)
    .then(()=>showStatus('loginStatus','Logado com sucesso','success'))
    .catch(err=>showStatus('loginStatus',err.message,'error'));
};

window.signup=()=>{
  const email=document.getElementById('email').value;
  const senha=document.getElementById('senha').value;
  createUserWithEmailAndPassword(auth,email,senha)
    .then(()=>showStatus('loginStatus','Cadastro realizado','success'))
    .catch(err=>{
      if(err.code==='auth/email-already-in-use'){
        showStatus('loginStatus','Email já cadastrado. Faça login.','error');
      }else{
        showStatus('loginStatus',err.message,'error');
      }
    });
};

window.logout=()=>{
  signOut(auth)
    .then(()=>showStatus('loginStatus','Desconectado com sucesso','success'))
    .catch(err=>showStatus('loginStatus',err.message,'error'));
};

// Boletos CRUD
window.addBoleto=()=>{
  const cliente=document.getElementById('boletoCliente').value;
  const valor=document.getElementById('boletoValor').value;
  const vencimento=document.getElementById('boletoVencimento').value;
  const status=document.getElementById('boletoStatusSelect').value;
  if(!cliente||!valor||!vencimento){showStatus('boletoStatus','Preencha todos os campos','error');return;}
  const key=push(ref(db,'boletos')).key;
  set(ref(db,'boletos/'+key),{cliente,valor,vencimento,status});
  document.getElementById('boletoCliente').value='';
  document.getElementById('boletoValor').value='';
  document.getElementById('boletoVencimento').value='';
  showStatus('boletoStatus','Boleto adicionado','success');
};

window.deleteBoleto=key=>remove(ref(db,'boletos/'+key));

// Securitizadoras CRUD
window.addSecuritizadora=()=>{
  const nome=document.getElementById('securitizadoraNome').value;
  if(!nome){showStatus('securitizadoraStatus','Digite o nome','error');return;}
  const key=push(ref(db,'securitizadoras')).key;
  set(ref(db,'securitizadoras/'+key),{nome});
  document.getElementById('securitizadoraNome').value='';
  showStatus('securitizadoraStatus','Securitizadora adicionada','success');
};

onValue(ref(db,'securitizadoras'),snapshot=>{
  const tbody=document.querySelector('#securitizadorasTable tbody');
  tbody.innerHTML='';
  snapshot.forEach(s=>{
    const data=s.val();
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${data.nome}</td><td><button onclick="deleteSecuritizadora('${s.key}')">Excluir</button></td>`;
    tbody.appendChild(tr);
  });
});

window.deleteSecuritizadora=key=>remove(ref(db,'securitizadoras/'+key));

// Chat
window.sendMsg=()=>{
  const msg=document.getElementById('chatMsg').value;
  if(!msg) return;
  const user=auth.currentUser?.email||'Anônimo';
  const key=push(ref(db,'chat')).key;
  set(ref(db,'chat/'+key),{user,msg,time:Date.now()});
  document.getElementById('chatMsg').value='';
};

onValue(ref(db,'chat'),snapshot=>{
  const box=document.getElementById('chatBox');
  box.innerHTML='';
  snapshot.forEach(s=>{
    const data=s.val();
    const date=new Date(data.time);
    const div=document.createElement('div');
    div.textContent=`[${date.toLocaleTimeString()}] ${data.user}: ${data.msg}`;
    box.appendChild(div);
  });
  document.getElementById('chatBox').scrollTop=box.scrollHeight;
});
</script>
</body>
</html>
