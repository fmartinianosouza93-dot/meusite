<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Cobrança SGC</title>
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f5f5f5;color:#333;}
header{background:#001f4d;color:#fff;padding:1rem;text-align:center;}
nav{display:flex;justify-content:center;background:#003366;}
nav button{margin:0.5rem;padding:0.5rem 1rem;border:none;border-radius:5px;background:#fff;cursor:pointer;}
nav button.active{background:#ffcc00;}
section{padding:1rem;display:none;}
section.active{display:block;}
input,select,textarea{padding:0.5rem;margin:0.5rem 0;width:100%;}
table{width:100%;border-collapse:collapse;margin-top:1rem;}
th,td{border:1px solid #ccc;padding:0.5rem;text-align:left;}
th{background:#eee;}
.chat-box{height:200px;overflow-y:scroll;border:1px solid #ccc;padding:0.5rem;background:#fff;}
.status-msg{margin-top:0.5rem;padding:0.5rem;border-radius:5px;display:none;}
.success{background:#d4edda;color:#155724;}
.error{background:#f8d7da;color:#721c24;}
</style>
</head>
<body>

<header>
  <h1>Sistema de Cobrança SGC</h1>
  <div id="user-info"></div>
</header>

<nav id="tabs" style="display:none;">
  <button onclick="showSection('inadimplentes')" class="active">Inadimplentes</button>
  <button onclick="showSection('chat')">Chat</button>
</nav>

<!-- Login -->
<section id="login" class="active">
  <h2>Identificação</h2>
  <input type="text" id="username" placeholder="Digite seu nome">
  <button onclick="login()">Entrar</button>
</section>

<!-- Inadimplentes -->
<section id="inadimplentes">
  <h2>Inadimplentes</h2>
  <table id="inadimplentesTable">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Vencimento</th>
        <th>Nota</th>
        <th>Valor</th>
        <th>Operador</th>
        <th>Ações</th>
        <th>Observações</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <h3>Adicionar Inadimplente</h3>
  <input type="text" id="cliente" placeholder="Cliente">
  <input type="date" id="vencimento">
  <input type="text" id="nota" placeholder="Nota">
  <input type="number" id="valor" placeholder="Valor">
  <button onclick="addInadimplente()">Adicionar</button>
</section>

<!-- Chat -->
<section id="chat">
  <h2>Chat</h2>
  <div class="chat-box" id="chatBox"></div>
  <input type="text" id="chatMsg" placeholder="Digite uma mensagem">
  <button onclick="sendMsg()">Enviar</button>
</section>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
  // Configuração Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCIxtoOmnVXtav5wUcURmq2VbaPlAGiQuY",
  authDomain: "sistemacobranca-76e7e.firebaseapp.com",
  databaseURL: "https://sistemacobranca-76e7e-default-rtdb.firebaseio.com",
  projectId: "sistemacobranca-76e7e",
  storageBucket: "sistemacobranca-76e7e.firebasestorage.app",
  messagingSenderId: "182543059899",
  appId: "1:182543059899:web:1948fc7a1af01574ad929e"
};

  // Inicializar
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUser = "";

  // Navegação
  function showSection(id){
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
    document.querySelector(`nav button[onclick="showSection('${id}')"]`).classList.add('active');
  }

  // Login simples
  function login(){
    const name = document.getElementById('username').value.trim();
    if(!name){ alert("Digite seu nome!"); return; }
    currentUser = name;
    document.getElementById('user-info').innerText = `Logado como: ${name}`;
    document.getElementById('login').style.display = 'none';
    document.getElementById('tabs').style.display = 'flex';
    showSection('inadimplentes');
  }

  // Inadimplentes CRUD
  function addInadimplente(){
    const cliente=document.getElementById('cliente').value.trim();
    const vencimento=document.getElementById('vencimento').value;
    const nota=document.getElementById('nota').value.trim();
    const valor=document.getElementById('valor').value;
    if(!cliente||!vencimento||!nota||!valor){alert("Preencha todos os campos!");return;}
    db.ref('inadimplentes').push({
      cliente,vencimento,nota,valor,operador:currentUser,observacoes:"",status:"NÃO PAGO"
    });
    document.getElementById('cliente').value="";
    document.getElementById('vencimento').value="";
    document.getElementById('nota').value="";
    document.getElementById('valor').value="";
  }

  db.ref('inadimplentes').on('value',snapshot=>{
    const tbody=document.querySelector('#inadimplentesTable tbody');
    tbody.innerHTML="";
    snapshot.forEach(s=>{
      const data=s.val();
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${data.cliente}</td>
        <td>${data.vencimento}</td>
        <td>${data.nota}</td>
        <td>${data.valor}</td>
        <td>${data.operador}</td>
        <td>
          <button onclick="setAcao('${s.key}','Securitizadora')">Securitizadora</button>
          <button onclick="setAcao('${s.key}','SGC')">SGC</button>
        </td>
        <td><input type="text" value="${data.observacoes||""}" 
             onblur="updateObs('${s.key}',this.value)"></td>
        <td>
          <button onclick="setStatus('${s.key}','PAGO')">Pago</button>
          <button onclick="setStatus('${s.key}','NÃO PAGO')">Não Pago</button>
        </td>`;
      tbody.appendChild(tr);
    });
  });

  function setAcao(key,acao){
    db.ref('inadimplentes/'+key+'/acao').set(acao);
  }
  function updateObs(key,valor){
    db.ref('inadimplentes/'+key+'/observacoes').set(valor);
  }
  function setStatus(key,valor){
    db.ref('inadimplentes/'+key+'/status').set(valor);
  }

  // Chat
  function sendMsg(){
    const msg=document.getElementById('chatMsg').value.trim();
    if(!msg||!currentUser) return;
    db.ref('chat').push({user:currentUser,msg,time:Date.now()});
    document.getElementById('chatMsg').value='';
  }

  db.ref('chat').on('child_added',snapshot=>{
    const data=snapshot.val();
    const box=document.getElementById('chatBox');
    const date=new Date(data.time);
    const div=document.createElement('div');
    div.textContent=`[${date.toLocaleTimeString()}] ${data.user}: ${data.msg}`;
    box.appendChild(div);
    box.scrollTop=box.scrollHeight;
  });
</script>

</body>
</html>
