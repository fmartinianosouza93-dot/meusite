<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Cobrança SGC</title>
  <style>
    body {font-family: Arial, sans-serif; margin:0; background:#f5f5f5; color:#333;}
    header {background:#001f4d; color:#fff; padding:1rem; text-align:center;}
    nav {display:flex; justify-content:center; background:#003366;}
    nav button {margin:0.5rem; padding:0.5rem 1rem; border:none; border-radius:5px; background:#fff; cursor:pointer;}
    nav button.active {background:#ffcc00;}
    section {padding:1rem; display:none;}
    section.active {display:block;}
    input, select, textarea {padding:0.5rem; margin:0.5rem 0; width:100%;}
    table {width:100%; border-collapse:collapse; margin-top:1rem;}
    th, td {border:1px solid #ccc; padding:0.5rem; text-align:left;}
    th {background:#eee;}
    .chat-box {height:200px; overflow-y:scroll; border:1px solid #ccc; padding:0.5rem; background:#fff;}
    .status-msg {margin-top:0.5rem; padding:0.5rem; border-radius:5px; display:none;}
    .success {background:#d4edda; color:#155724;}
    .error {background:#f8d7da; color:#721c24;}
    .action-btn {margin:0 2px; padding:2px 6px; font-size:12px; cursor:pointer; border:none; border-radius:4px;}
    .sgc {background:#007bff; color:#fff;}
    .sec {background:#6f42c1; color:#fff;}
    .pago {background:#28a745; color:#fff;}
    .naopago {background:#dc3545; color:#fff;}
    .delete {background:#6c757d; color:#fff;}
  </style>
</head>
<body>

<header>
  <h1>Sistema de Cobrança SGC</h1>
  <div id="user-info"></div>
</header>

<nav>
  <button onclick="showSection('login')" class="active">Login</button>
  <button onclick="showSection('inadimplentes')">Inadimplentes</button>
  <button onclick="showSection('chat')">Chat</button>
</nav>

<!-- Login -->
<section id="login" class="active">
  <h2>Identificação</h2>
  <input type="text" id="username" placeholder="Digite seu nome">
  <button onclick="enterSystem()">Entrar</button>
  <div id="loginStatus" class="status-msg"></div>
</section>

<!-- Inadimplentes -->
<section id="inadimplentes">
  <h2>Inadimplentes</h2>

  <h3>Adicionar Cliente</h3>
  <input type="text" id="clienteNome" placeholder="Cliente">
  <input type="date" id="clienteVencimento">
  <input type="text" id="clienteNota" placeholder="Nota">
  <input type="number" id="clienteValor" placeholder="Valor">
  <button onclick="addCliente()">Adicionar</button>

  <h3>Filtros</h3>
  <input type="text" id="filtroNome" placeholder="Filtrar por nome" onkeyup="filtrarClientes()">
  <select id="filtroStatus" onchange="filtrarClientes()">
    <option value="">Todos</option>
    <option value="SGC">SGC</option>
    <option value="Securitizadora">Securitizadora</option>
    <option value="Não Pago">Não Pago</option>
    <option value="Pago">Pago</option>
  </select>

  <table id="inadTable">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Vencimento</th>
        <th>Nota</th>
        <th>Valor</th>
        <th>Operador</th>
        <th>Status</th>
        <th>Observações</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- Chat -->
<section id="chat">
  <h2>Chat</h2>
  <div class="chat-box" id="chatBox"></div>
  <input type="text" id="chatMsg" placeholder="Digite uma mensagem">
  <button onclick="sendMsg()">Enviar</button>
</section>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDgpKA5IyE7IGYvxoSIHEqvhgY_OqU4w7k",
    authDomain: "sistema-de-cobranca-a1ede.firebaseapp.com",
    databaseURL: "https://sistema-de-cobranca-a1ede-default-rtdb.firebaseio.com",
    projectId: "sistema-de-cobranca-a1ede",
    storageBucket: "sistema-de-cobranca-a1ede.appspot.com",
    messagingSenderId: "817281254537",
    appId: "1:817281254537:web:398b007b96af406c91f258"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUser = null;

  function showSection(id){
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
    document.querySelector(`nav button[onclick="showSection('${id}')"]`).classList.add('active');
  }

  function enterSystem(){
    const name=document.getElementById('username').value.trim();
    if(!name){alert("Digite seu nome");return;}
    currentUser=name;
    document.getElementById('user-info').innerText=`Logado como: ${currentUser}`;
    showSection('inadimplentes');
  }

  // ---- INADIMPLENTES CRUD ----
  function addCliente(){
    const cliente=document.getElementById('clienteNome').value.trim();
    const vencimento=document.getElementById('clienteVencimento').value;
    const nota=document.getElementById('clienteNota').value.trim();
    const valor=document.getElementById('clienteValor').value;
    if(!cliente||!vencimento||!nota||!valor){alert("Preencha todos os campos");return;}
    const key=db.ref('inadimplentes').push().key;
    db.ref('inadimplentes/'+key).set({
      cliente,vencimento,nota,valor,operador:currentUser,status:"Não Pago",obs:""
    });
    document.getElementById('clienteNome').value="";
    document.getElementById('clienteVencimento').value="";
    document.getElementById('clienteNota').value="";
    document.getElementById('clienteValor').value="";
  }

  db.ref('inadimplentes').on('value', snapshot=>{
    const tbody=document.querySelector('#inadTable tbody');
    tbody.innerHTML="";
    snapshot.forEach(s=>{
      const d=s.val();
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${d.cliente}</td>
        <td>${d.vencimento}</td>
        <td>${d.nota}</td>
        <td>${d.valor}</td>
        <td>${d.operador}</td>
        <td>${d.status}</td>
        <td><textarea onchange="updateObs('${s.key}',this.value)">${d.obs||""}</textarea></td>
        <td>
          <button class="action-btn sgc" onclick="updateStatus('${s.key}','SGC')">SGC</button>
          <button class="action-btn sec" onclick="updateStatus('${s.key}','Securitizadora')">Securitizadora</button>
          <button class="action-btn pago" onclick="markPago('${s.key}')">Pago</button>
          <button class="action-btn naopago" onclick="updateStatus('${s.key}','Não Pago')">Não Pago</button>
          <button class="action-btn delete" onclick="deleteCliente('${s.key}')">Excluir</button>
        </td>`;
      tbody.appendChild(tr);
    });
  });

  function updateObs(key,val){
    db.ref('inadimplentes/'+key).update({obs:val});
  }
  function updateStatus(key,status){
    db.ref('inadimplentes/'+key).update({status:status});
  }
  function markPago(key){
    db.ref('inadimplentes/'+key).remove();
  }
  function deleteCliente(key){
    db.ref('inadimplentes/'+key).remove();
  }

  function filtrarClientes(){
    const nome=document.getElementById('filtroNome').value.toLowerCase();
    const status=document.getElementById('filtroStatus').value;
    document.querySelectorAll('#inadTable tbody tr').forEach(tr=>{
      const tds=tr.querySelectorAll('td');
      const matchNome=tds[0].innerText.toLowerCase().includes(nome);
      const matchStatus=!status||tds[5].innerText===status;
      tr.style.display=(matchNome&&matchStatus)?"":"none";
    });
  }

  // ---- CHAT ----
  function sendMsg(){
    const msg=document.getElementById('chatMsg').value.trim();
    if(!msg||!currentUser){return;}
    const key=db.ref('chat').push().key;
    db.ref('chat/'+key).set({user:currentUser,msg,time:Date.now()});
    document.getElementById('chatMsg').value="";
  }

  db.ref('chat').on('child_added', snapshot=>{
    const d=snapshot.val();
    const box=document.getElementById('chatBox');
    const date=new Date(d.time);
    const div=document.createElement('div');
    div.textContent=`[${date.toLocaleTimeString()}] ${d.user}: ${d.msg}`;
    if(d.user===currentUser){
      const btn=document.createElement('button');
      btn.textContent="Excluir";
      btn.style.marginLeft="10px";
      btn.onclick=()=>db.ref('chat/'+snapshot.key).remove();
      div.appendChild(btn);
    }
    box.appendChild(div);
    box.scrollTop=box.scrollHeight;
  });

  db.ref('chat').on('child_removed', snapshot=>{
    const box=document.getElementById('chatBox');
    box.innerHTML="";
    db.ref('chat').once('value', snap=>{
      snap.forEach(s=>{
        const d=s.val();
        const date=new Date(d.time);
        const div=document.createElement('div');
        div.textContent=`[${date.toLocaleTimeString()}] ${d.user}: ${d.msg}`;
        if(d.user===currentUser){
          const btn=document.createElement('button');
          btn.textContent="Excluir";
          btn.style.marginLeft="10px";
          btn.onclick=()=>db.ref('chat/'+s.key).remove();
          div.appendChild(btn);
        }
        box.appendChild(div);
      });
    });
  });
</script>
</body>
</html>
