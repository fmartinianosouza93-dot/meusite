<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Cobrança SGC</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f5f5f5; color: #333; }
    header { background: #001f4d; color: #fff; padding: 1rem; text-align: center; }
    nav { display: flex; justify-content: center; background: #003366; }
    nav button { background: none; border: none; color: #fff; padding: 1rem; cursor: pointer; font-size: 1rem; }
    nav button:hover { background: #0055a5; }
    section { display: none; padding: 1rem; }
    section.active { display: block; }
    input, button, textarea, select { padding: 0.5rem; margin: 0.3rem 0; }

    table { border-collapse: collapse; width: 100%; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: center; }

    #chat-box { border: 1px solid #ccc; height: 300px; overflow-y: scroll; background: #fff; padding: 0.5rem; }
    .msg { margin: 0.3rem 0; padding: 0.5rem; border-radius: 5px; background: #eef; display: flex; justify-content: space-between; align-items: center; }
    .msg strong { color: #001f4d; }
    .msg button { background: red; color: #fff; border: none; padding: 0.2rem 0.5rem; cursor: pointer; border-radius: 4px; }
  </style>
</head>
<body>
  <header>
    <h1>Sistema de Cobrança SGC</h1>
  </header>

  <nav>
    <button onclick="showSection('login')">Login</button>
    <button onclick="showSection('inadimplentes')">Inadimplentes</button>
    <button onclick="showSection('chat')">Chat</button>
  </nav>

  <!-- LOGIN -->
  <section id="login" class="active">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Digite seu nome">
    <button onclick="login()">Entrar</button>
    <p id="welcome"></p>
  </section>

  <!-- INADIMPLENTES -->
  <section id="inadimplentes">
    <h2>Clientes Inadimplentes</h2>
    <table>
      <thead>
        <tr>
          <th>Cliente</th>
          <th>Vencimento</th>
          <th>Nota</th>
          <th>Valor</th>
          <th>Operador</th>
          <th>Ação</th>
          <th>Observações</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="table-inadimplentes"></tbody>
    </table>
  </section>

  <!-- CHAT -->
  <section id="chat">
    <h2>Chat</h2>
    <div id="chat-box"></div>
    <input type="text" id="chat-msg" placeholder="Digite uma mensagem">
    <button onclick="sendMessage()">Enviar</button>
  </section>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "SUA_APIKEY",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      databaseURL: "https://SEU_PROJETO.firebaseio.com",
      projectId: "SEU_PROJETO",
      storageBucket: "SEU_PROJETO.appspot.com",
      messagingSenderId: "000000000",
      appId: "1:000000000:web:xxxxxx"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let currentUser = "";

    // Navegação
    function showSection(id) {
      document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }
    window.showSection = showSection;

    // Login
    function login() {
      const name = document.getElementById("username").value.trim();
      if (name) {
        currentUser = name;
        document.getElementById("welcome").innerText = "Bem-vindo, " + currentUser;
        showSection("inadimplentes");
      }
    }
    window.login = login;

    // Chat
    const chatRef = ref(db, "chat");
    function sendMessage() {
      const text = document.getElementById("chat-msg").value.trim();
      if (text && currentUser) {
        push(chatRef, { user: currentUser, text });
        document.getElementById("chat-msg").value = "";
      }
    }
    window.sendMessage = sendMessage;

    function deleteMessage(id) {
      remove(ref(db, "chat/" + id));
    }
    window.deleteMessage = deleteMessage;

    onValue(chatRef, snapshot => {
      const box = document.getElementById("chat-box");
      box.innerHTML = "";
      snapshot.forEach(msg => {
        const data = msg.val();
        const div = document.createElement("div");
        div.className = "msg";
        div.innerHTML = `<span><strong>${data.user}:</strong> ${data.text}</span>`;
        if (data.user === currentUser) {
          const btn = document.createElement("button");
          btn.innerText = "Excluir";
          btn.onclick = () => deleteMessage(msg.key);
          div.appendChild(btn);
        }
        box.appendChild(div);
      });
    });

    // Inadimplentes
    const inadRef = ref(db, "inadimplentes");
    function renderInadimplentes() {
      onValue(inadRef, snapshot => {
        const tbody = document.getElementById("table-inadimplentes");
        tbody.innerHTML = "";
        snapshot.forEach(item => {
          const data = item.val();
          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td>${data.cliente}</td>
            <td>${data.vencimento}</td>
            <td>${data.nota}</td>
            <td>${data.valor}</td>
            <td>${data.operador}</td>
            <td>
              <button onclick="updateInad('${item.key}', {acao:'SGC'})">SGC</button>
              <button onclick="updateInad('${item.key}', {acao:'Securitizadora'})">Securitizadora</button>
            </td>
            <td><textarea onchange="updateInad('${item.key}', {obs:this.value})">${data.obs || ""}</textarea></td>
            <td>
              <button onclick="updateInad('${item.key}', {status:'Pago'})">Pago</button>
              <button onclick="updateInad('${item.key}', {status:'Não Pago'})">Não Pago</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      });
    }
    renderInadimplentes();

    function updateInad(id, updates) {
      update(ref(db, "inadimplentes/" + id), updates);
    }
    window.updateInad = updateInad;

  </script>
</body>
</html>
